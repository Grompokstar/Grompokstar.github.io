<!DOCTYPE html>

<html>

<head>
    <title>Chervontsev Roman</title>
    <script type="text/javascript" src="./libs/three.min.js"></script>
    <script type="text/javascript" src="./libs/dat.gui.js"></script>
    <script type="text/javascript" src="./libs/TrackballControls.js"></script>
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
<div id="logo">
    <img src="./assets/imgs/octabrain_logo.svg">
</div>

<div id="WebGL-output"></div>

<script type="text/javascript">
    function init() {
        var scene = new THREE.Scene(),
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000),
            renderer = new THREE.WebGLRenderer();

        renderer.setClearColor(new THREE.Color(0xE5E5E5, 1.0));
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMapEnabled = true;

        var sphereGeometry = new THREE.SphereGeometry(3, 40, 40);
        var sphereMaterial = new THREE.MeshLambertMaterial({color: 0x7777ff});
        var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);

        sphere.position.x = 20;
        sphere.position.y = 0;
        sphere.position.z = 0;
        scene.add(sphere);

        camera.position.x = -30;
        camera.position.y = 40;
        camera.position.z = 30;
        camera.lookAt(scene.position);

        var ambientLight = new THREE.AmbientLight(0x0c0c0c);
        scene.add(ambientLight);

        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(-40, 60, -10);
        spotLight.castShadow = true;
        scene.add(spotLight);

        document.getElementById("WebGL-output").appendChild(renderer.domElement);

        window.addEventListener( 'resize', onWindowResize, false );

        var cameraControls = new THREE.TrackballControls( camera, renderer.domElement );
        cameraControls.minDistance = 20;
        cameraControls.maxDistance = 400.0;
        cameraControls.dynamicDampingFactor = 0.5;

        var controls = new function () {
            this.rotationSpeed = 0.02;
            this.bouncingSpeed = 0.03;

            this.removeCube = function() {
                var allChildren = scene.children;
                var lastObject = allChildren[allChildren.length-1];
                if (lastObject instanceof THREE.Mesh) {
                    scene.remove(lastObject);
                }
            };

            this.addCube = function() {
                var cubeSize = Math.ceil((Math.random() * 3));
                var cubeGeometry = new THREE.CubeGeometry(cubeSize,cubeSize,cubeSize);
                var cubeMaterial = new THREE.MeshLambertMaterial({color:  Math.random() * 0xffffff });
                var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
                cube.name = "cube-" + scene.children.length;

                cube.position.x= -20 + Math.round((Math.random() * 20));
                cube.position.y= Math.round((Math.random() * 20));
                cube.position.z= Math.round((Math.random() * 20));

                scene.add(cube);
            };
        };

        var gui = new dat.GUI();
        gui.add(controls, 'rotationSpeed', 0, 0.5);
        gui.add(controls, 'bouncingSpeed', 0, 0.5);
        gui.add(controls, 'addCube');
        gui.add(controls, 'removeCube');

        var step = 0;

        render();

        function render() {
            animation();
            requestAnimationFrame(render);
            cameraControls.update();
            renderer.render(scene, camera);
        }

        function animation() {
            step += controls.bouncingSpeed;

            sphere.position.x = 20 * Math.cos(step);
            sphere.position.y = 20 * Math.sin(step);

            scene.traverse(function(e) {
                if (e instanceof THREE.Mesh) {
                    e.rotation.x+=controls.rotationSpeed;
                    e.rotation.y+=controls.rotationSpeed;
                }
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
        }
    }
    window.onload = init();

</script>
</body>
</html>